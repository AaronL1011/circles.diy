{{define "circles"}}
{{template "base" .}}
{{end}}

{{define "main"}}
<div class="circles-page">
    <div class="circles-header">
        <div class="circles-title-section">
            <h1 class="circles-title">My Circles</h1>
            <p class="circles-subtitle">Stay connected with your communities and discover new ones</p>
        </div>
        <div class="circles-actions">
            <button class="btn-secondary" hx-get="/circles/search" hx-target="#modal">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
                    <path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>
                </svg>
                Discover Circles
            </button>
            <button class="btn-primary" hx-get="/circles/create" hx-target="#modal">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
                    <path d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"></path>
                </svg>
                Create Circle
            </button>
        </div>
    </div>

    <!-- <div class="circles-stats">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{.Stats.TotalPosts}}</div>
                <div class="stat-label">Total Posts</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{.Stats.ActiveMembers}}</div>
                <div class="stat-label">Active Members</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{.Stats.WeeklyGrowth}}</div>
                <div class="stat-label">Weekly Growth</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{.Stats.EngagementRate}}</div>
                <div class="stat-label">Engagement Rate</div>
            </div>
        </div>
    </div> -->

    <div class="circles-content">
        <div class="circles-main">
            <section class="my-circles-section">
                <div class="section-header">
                    <h2>Your Circles</h2>
                    <div class="filter-tabs">
                        <button class="filter-tab active" data-filter="all">All</button>
                        <button class="filter-tab" data-filter="active">Active</button>
                        <button class="filter-tab" data-filter="admin">Admin</button>
                    </div>
                </div>
                
                <div class="circles-grid" id="circles-grid">
                    {{range .Circles}}
                    {{template "circle-card" .}}
                    {{end}}
                </div>
            </section>

            <section class="featured-circles-section">
                <div class="section-header">
                    <h2>Discover New Circles</h2>
                    <button class="see-all-btn">
                        Browse All
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
                            <path d="m221.66,133.66-72,72a8,8,0,0,1-11.32-11.32L196.69,136H40a8,8,0,0,1,0-16H196.69L138.34,61.66a8,8,0,0,1,11.32-11.32l72,72A8,8,0,0,1,221.66,133.66Z"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="featured-grid">
                    {{range .FeaturedCircles}}
                    <div class="featured-circle" hx-get="/circles/{{.ID}}/preview" hx-target="#modal">
                        <div class="featured-thumbnail">
                            <img src="{{.Thumbnail}}" alt="{{.Name}}" />
                        </div>
                        <div class="featured-info">
                            <h3 class="featured-name">{{.Name}}</h3>
                            <p class="featured-description">{{.Description}}</p>
                            <div class="featured-meta">
                                <span class="featured-members">{{.MemberCount}} members</span>
                                <span class="featured-active">{{.OnlineCount}} online</span>
                            </div>
                        </div>
                        <button class="join-btn">
                            Join Circle
                        </button>
                    </div>
                    {{end}}
                </div>
            </section>
        </div>

        <aside class="circles-sidebar">
            <div class="sidebar-section">
                <h3>Recent Activity</h3>
                <div class="activity-list">
                    {{range .RecentActivity}}
                    <div class="activity-item" hx-get="/circles/{{.CircleID}}" hx-target="#main-content">
                        <div class="activity-icon">
                            {{if eq .Type "post"}}
                            <svg xmlns="http://www.w3.org/2000/svg" width="1.5rem" height="1.5rem" fill="currentColor" viewBox="0 0 256 256"><path d="M88,96a8,8,0,0,1,8-8h64a8,8,0,0,1,0,16H96A8,8,0,0,1,88,96Zm8,40h64a8,8,0,0,0,0-16H96a8,8,0,0,0,0,16Zm32,16H96a8,8,0,0,0,0,16h32a8,8,0,0,0,0-16ZM224,48V156.69A15.86,15.86,0,0,1,219.31,168L168,219.31A15.86,15.86,0,0,1,156.69,224H48a16,16,0,0,1-16-16V48A16,16,0,0,1,48,32H208A16,16,0,0,1,224,48ZM48,208H152V160a8,8,0,0,1,8-8h48V48H48Zm120-40v28.7L196.69,168Z"></path></svg>
                            {{else if eq .Type "event"}}
                            <svg xmlns="http://www.w3.org/2000/svg" width="1.5rem" height="1.5rem" fill="currentColor" viewBox="0 0 256 256"><path d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM72,48v8a8,8,0,0,0,16,0V48h80v8a8,8,0,0,0,16,0V48h24V80H48V48ZM208,208H48V96H208V208Zm-68-76a12,12,0,1,1-12-12A12,12,0,0,1,140,132Zm44,0a12,12,0,1,1-12-12A12,12,0,0,1,184,132ZM96,172a12,12,0,1,1-12-12A12,12,0,0,1,96,172Zm44,0a12,12,0,1,1-12-12A12,12,0,0,1,140,172Zm44,0a12,12,0,1,1-12-12A12,12,0,0,1,184,172Z"></path></svg>
                            {{else if eq .Type "announcement"}}
                            <svg xmlns="http://www.w3.org/2000/svg" width="1.5rem" height="1.5rem" fill="currentColor" viewBox="0 0 256 256"><path d="M248,120a48.05,48.05,0,0,0-48-48H160.2c-2.91-.17-53.62-3.74-101.91-44.24A16,16,0,0,0,32,40V200a16,16,0,0,0,26.29,12.25c37.77-31.68,77-40.76,93.71-43.3v31.72A16,16,0,0,0,159.12,214l11,7.33A16,16,0,0,0,194.5,212l11.77-44.36A48.07,48.07,0,0,0,248,120ZM48,199.93V40h0c42.81,35.91,86.63,45,104,47.24v65.48C134.65,155,90.84,164.07,48,199.93Zm131,8,0,.11-11-7.33V168h21.6ZM200,152H168V88h32a32,32,0,1,1,0,64Z"></path></svg>
                            {{else}}
                           <svg xmlns="http://www.w3.org/2000/svg" width="1.5rem" height="1.5rem" fill="currentColor" viewBox="0 0 256 256"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></svg>
                            {{end}}
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">{{.Title}}</div>
                            <div class="activity-meta">
                                <span class="activity-user">{{.User}}</span>
                                <span class="activity-time">{{.TimeAgo}}</span>
                            </div>
                        </div>
                    </div>
                    {{end}}
                </div>
                <button class="sidebar-action-btn" hx-get="/activity/all" hx-target="#main-content">View All Activity</button>
            </div>
        </aside>
    </div>
</div>

<!-- Modal container for HTMX -->
<div id="modal" hx-swap-oob="true"></div>
{{end}}

{{define "scripts"}}
<script>
// Filter functionality for circles
document.addEventListener('DOMContentLoaded', function() {
    const filterTabs = document.querySelectorAll('.filter-tab');
    const circleCards = document.querySelectorAll('.circle-card');
    
    filterTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const filter = this.dataset.filter;
            
            // Update active tab
            filterTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Filter circles
            circleCards.forEach(card => {
                const shouldShow = filter === 'all' || 
                    (filter === 'active' && card.dataset.active === 'true') ||
                    (filter === 'admin' && (card.dataset.role === 'admin' || card.dataset.role === 'owner'));
                
                card.style.display = shouldShow ? 'block' : 'none';
            });
        });
    });
});

// HTMX event listeners
document.body.addEventListener('htmx:afterSwap', function(evt) {
    if (evt.detail.target.id === 'circles-grid') {
        console.log('Circles grid updated');
    }
});

document.body.addEventListener('htmx:responseError', function(evt) {
    console.error('HTMX Error:', evt.detail.xhr.responseText);
});
</script>
{{end}}